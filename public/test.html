<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ESP Cloud Message Test</title>
  <style>
    body{margin:0;font-family:Segoe UI,Arial;background:#0b1220;color:#e9eefc}
    .wrap{padding:20px;max-width:980px;margin:0 auto}
    .card{background:#0e1730;border:1px solid #1e2a4a;border-radius:16px;padding:18px;box-shadow:0 8px 28px rgba(0,0,0,.35)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{font-size:12px;opacity:.85}
    input,select,button{width:100%;padding:12px;border-radius:12px;border:1px solid #22335f;background:#0b1220;color:#e9eefc;outline:none}
    button{cursor:pointer;border:0;background:#0b5ed7;font-weight:800}
    .row{display:flex;gap:10px;margin-top:12px}
    .status{margin-top:10px;font-size:13px;opacity:.9}
    .ok{color:#2dbb4e;font-weight:800}
    .bad{color:#ff5b5b;font-weight:800}
    .small{opacity:.7;font-size:12px;margin-top:8px;line-height:1.35}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #22335f;background:#0b1220;font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h2 style="margin:0 0 8px 0">ESP Cloud Message Test</h2>
      <div class="small">
        This page sends to <span class="pill">POST /api/simple</span>
        and ESP pulls from <span class="pill">GET /api/pull/ESP_001</span>.
      </div>

      <div class="grid" style="margin-top:14px">
        <div>
          <label>Device ID</label>
          <input id="device" value="ESP_001" />
        </div>
        <div>
          <label>Force</label>
          <select id="force">
            <option value="">AUTO</option>
            <option value="red">RED</option>
            <option value="amber">AMBER</option>
            <option value="green">GREEN</option>
          </select>
        </div>
      </div>

      <div class="grid" style="margin-top:12px">
        <div>
          <label>Signal group</label>
          <select id="sig">
            <option value="red">RED</option>
            <option value="amber">AMBER</option>
            <option value="green">GREEN</option>
            <option value="no">NO</option>
          </select>
        </div>
        <div>
          <label>Slot</label>
          <select id="slot">
            <option value="0">Message 1</option>
            <option value="1">Message 2</option>
            <option value="2">Message 3</option>
            <option value="3">Message 4</option>
            <option value="4">Message 5</option>
          </select>
        </div>
      </div>

      <div style="margin-top:12px">
        <label>Line 1</label>
        <input id="l1" value="HELLO FROM CLOUD" />
      </div>

      <div style="margin-top:12px">
        <label>Line 2</label>
        <input id="l2" value="DRIVE SAFE" />
      </div>

      <div class="row">
        <button onclick="sendNow()">Send to ESP (Cloud)</button>
        <button onclick="peekNow()" style="background:#334155">Peek Cloud Data</button>
      </div>

      <div class="status" id="st">Idle</div>
      <pre id="out" style="margin-top:10px;white-space:pre-wrap;opacity:.9"></pre>

      <div class="small">
        If you get “Network error”, open DevTools → Console. Usually it is:
        wrong URL path, server not deployed, or you are hitting another service.
      </div>
    </div>
  </div>

<script>
async function sendNow(){
  const device_id = document.getElementById("device").value.trim();
  const force = document.getElementById("force").value;
  const sig = document.getElementById("sig").value;
  const slot = Number(document.getElementById("slot").value);
  const l1 = document.getElementById("l1").value;
  const l2 = document.getElementById("l2").value;

  const st = document.getElementById("st");
  const out = document.getElementById("out");
  st.innerHTML = "Sending...";
  out.textContent = "";

  try{
    const res = await fetch("/api/simple", {
      method:"POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ device_id, force, sig, slot, l1, l2 })
    });
    const data = await res.json();
    if(res.ok){
      st.innerHTML = '<span class="ok">Sent ✅</span>';
      out.textContent = JSON.stringify(data, null, 2);
    }else{
      st.innerHTML = '<span class="bad">Failed ❌</span>';
      out.textContent = JSON.stringify(data, null, 2);
    }
  }catch(e){
    st.innerHTML = '<span class="bad">Network error ❌</span>';
    out.textContent = String(e);
  }
}

async function peekNow(){
  const device_id = document.getElementById("device").value.trim();
  const st = document.getElementById("st");
  const out = document.getElementById("out");
  st.innerHTML = "Loading...";
  out.textContent = "";
  try{
    const res = await fetch("/api/peek/" + encodeURIComponent(device_id));
    const data = await res.json();
    st.innerHTML = '<span class="ok">OK ✅</span>';
    out.textContent = JSON.stringify(data, null, 2);
  }catch(e){
    st.innerHTML = '<span class="bad">Network error ❌</span>';
    out.textContent = String(e);
  }
}
</script>
</body>
</html>